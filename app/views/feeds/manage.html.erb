<% content_for :stylesheets do %>
	<%= stylesheet_link_tag "feeds.css", "manageFeeds.css" %>
<% end %>

<% content_for :javascripts do %>
	<%= javascript_include_tag "manageFeeds.js" %>
<%end%>

<div style="margin-bottom: 20px;">
	<h3 style="margin-bottom: 10px;">Manage your feeds</h3>
	<div>
		<a href="#addFeed-modal-content" data-toggle="modal" class="btn" style="margin-right: 25px;">Add feed</a>
		<a href="/feeds/import" data-toggle="modal" class="btn">Import feeds</a>
		<div style="clear"></div>
	</div>
	<div style="clear"></div>
</div>
	
	<%@feeds.each do |feed| %>
		<div id="feed_<%= feed.id %>" class="manageFeedRow">
			<span class="manageFeedRowTitle"><strong><a href="<%= feed.url %>"><%= feed.title %></a></strong></span>
			
			<!--
			<%if feed.status == 1 then %>
				<span class ="manageFeedRowOKStatus">Up to date!</span>
			<% elsif feed.status == 2 then %>
				<span class ="manageFeedRowWaitingStatus">Still loading...</span>
			<% else %>
				<span class ="manageFeedRowErrorStatus">Uh oh, something is wrong :(</span>
			<% end %>
			-->
			
			<ul class="manageFeedRowTags">
				<% @tags.each do |tag| %>
					<% if tag.feed_id == feed.id then %>
					<li id="tag_<%=tag.id %>"><%= tag.name %></li>	
					<% end %>
				<% end %>
			</ul>
	
			<%= link_to "Delete feed", unsubscribe_path(feed.id), :remote => true, :class => "unsubscribe", :id => "unsubscribe_"+feed.id.to_s %>
			<a onclick="return false;" class="addTagsLink" href="#addTags-modal-content" data-toggle="modal" data-id="<%= feed.id %>">Add tags</a>
			<a onclick="return false;" href="#deleteTags-modal-content" data-toggle="modal" onclick="populateDeleteTags(<%= feed.id %>)">Delete tags</a>
	
			<script type="text/javascript">
				$(document).ready(function() {
					$('#unsubscribe_<%= feed.id %>').bind("ajax:success", function(status, data, xhr) {
						$("#feed_<%= feed.id %>").remove();
					});
				});
			</script>			
		</div>
	<% end %>
	
	<div id="addTags-modal-content" class="modal hide">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">×</button>
			<h3>Add tags</h3>
		</div>
		<div id="modal-body" class="modal-body-style">
			<%= render 'tags/form' %>
		</div>
	</div>
	
	<div id="deleteTags-modal-content" class="modal hide">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">×</button>
			<h3>Delete tags</h3>
		</div>
		<div id="modal-body" class="modal-body-style">
			<p>Click on a tag to delete it</p>
			<div id="feedTagsToDelete">
			</div>
			<button type="button" data-dismiss="modal">cancel</button>
		</div>
	</div>

	<div id="addFeed-modal-content" class="modal hide">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">×</button>
			<h3>Add RSS feed by URL</h3>
		</div>
		<div id="modal-body" class="modal-body-style">
			<%= render 'feeds/form' %>
		</div>
	</div>
